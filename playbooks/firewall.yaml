- name: Setup Opnsense firewall
  hosts: firewalls
  connection: local # Run from the control node (=this machine)
  gather_facts: no # No point in gathering facts on the local machine
  module_defaults:
    group/ansibleguy.opnsense.all:
      ssl_verify: false
      firewall: "{{ ansible_host }}"
      api_key: "{{ opnsense_api_key }}"
      api_secret: "{{ opnsense_api_secret }}"
  tasks:
    - name: Reboot 
      ansibleguy.opnsense.system:
        action: 'reboot'

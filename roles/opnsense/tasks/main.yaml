---
# tasks file for opnsense
- name: Configure aliases
  ansibleguy.opnsense.alias_multi:
    aliases: "{{ aliases }}"
- name: Purge all non-configured aliases
  ansibleguy.opnsense.alias_multi:
    aliases: "{{ aliases }}"
- name: List aliases
  ansibleguy.opnsense.list:
    target: alias
- name: Configure rules
  ansibleguy.opnsense.rule_multi:
    key_field: "sequence"
    match_fields: ["description"]
    rules: "{{ rules }}"
- name: Purge all non-configured rules
  ansibleguy.opnsense.rule_purge:
    key_field: "sequence"
    match_fields: ["description"]
    rules: "{{ rules }}"
- name: List rules
  ansibleguy.opnsense.list:
    target: rule
- name: Configure DNS entries
  ansibleguy.opnsense.unbound_host:
    hostname: "{{ item.hostname | default(\"*\") }}"
    domain: "{{ item.domain }}"
    value: "{{ item.value }}"
    description: "{{ item.description }}"
    match_fields: "{{ item.match_fields | default([\"description\"]) }}"
  loop: "{{ dns_entries }}"
- name: List DNS entries
  ansibleguy.opnsense.list:
    target: unbound_host
# TODO remove other dns entries (needs to be done manually with a loop, no purge module there)

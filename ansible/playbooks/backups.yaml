---
- name: Setup backups
  hosts: backupservs
  roles:
    - role: backups
      vars:
        backups_snapshots:
          - default_cron:
              hour: 6
              minute: 0
            zfs_pool: nfs_pool
            filesystems:
              - name: home-assistant
            archiving:
              target_dir: /srv/nfs/backups/k3s-volumes
              subdir_per_filesystem: false
              cron:
                # day: 1
                hour: 6
                minute: 30
              # TODO use this to generate a tar.gz archive from the latest snapshots
              # Then create a backups_cleanup property with a list of cron+regex+retention_days dicts to run cleanup jobs
              # Then modify restore job so that when a matching rclone config exists, the search for latest item includes rclone dir
              # Then final test: recreate nfs serv from scratch, and restore : should get functional home assistant with previous data

        backups_rclone_conf_template_path: ./resources/backups/rclone.conf
        backups_rclone:
          - cron:
              hour: 7
              minute: 0
            src: /srv/nfs/backups
            target: "proton:/backups/homeserver-staging"

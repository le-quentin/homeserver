---
services:
  alloy:
    image: grafana/alloy:v1.10.1
    container_name: alloy
    command: run --server.http.listen-addr=0.0.0.0:12345 --storage.path=/var/lib/alloy/data /etc/alloy/config.alloy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /var/log:/var/log:ro
      - ./config/alloy-config.alloy:/etc/alloy/config.alloy:ro
      - alloy-data:/var/lib/alloy/data
    networks:
      - monitoring
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:12345/ready"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  alloy-data:
    external: true

networks:
  monitoring:
    external: true
